<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tomato Disease Detector</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background-color: #f7f9f9;
    }
    h1 {
      color: #208fd0;
      font-size: 2em;
    }
    #preview {
      margin-top: 20px;
      max-width: 90%;
      height: auto;
      border: 2px solid #208fd0;
      border-radius: 10px;
    }
    
    /* Style for custom file input buttons */
    .file-input-container {
      margin: 20px 0;
    }
    
    .file-input-label {
      display: inline-block;
      padding: 12px 24px;
      margin: 10px 5px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      color: white;
      font-size: 1em;
    }
    
    .camera-btn {
      background-color: #208fd0;
    }
    
    .camera-btn:hover {
      background-color: #105a80;
    }
    
    .gallery-btn {
      background-color: #28a745;
    }
    
    .gallery-btn:hover {
      background-color: #218838;
    }
    
    .hidden-input {
      display: none;
    }
    
    button {
      margin: 15px 5px;
      padding: 12px 30px;
      font-size: 1em;
      border-radius: 8px;
      border: none;
      background-color: #208fd0;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    
    button:hover {
      background-color: #105a80;
    }
    
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    #result {
      margin-top: 20px;
      padding: 20px;
      font-size: 1.1em;
      background-color: #f8f9fa;
      border-radius: 10px;
      border: 1px solid #208fd0;
      display: none;
    }
    
    .loading {
      color: #208fd0;
      font-weight: bold;
    }
    
    .error {
      color: #dc3545;
      font-weight: bold;
    }
    
    .success {
      color: #28a745;
    }
    
    footer {
      margin-top: 50px;
      padding: 20px;
      background-color: #e8f5e9;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .avatar {
      width: 60px;
      height: 60px;
      background-color: #208fd0;
      border-radius: 50%;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }
    
    footer p {
      margin: 5px 0;
      color: #666;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.5em; }
      .file-input-label { 
        font-size: 0.9em; 
        padding: 10px 20px;
        margin: 5px 2px;
      }
      button { font-size: 0.9em; padding: 10px 25px; }
      #result { font-size: 1em; }
      .avatar { width: 50px; height: 50px; font-size: 16px; }
    }
  </style>
</head>
<body>
  <h1>üçÖ Tomato Disease Detector</h1>
  <p>Upload a tomato leaf image or take a picture to detect diseases.</p>

  <div class="file-input-container">
    <!-- Camera input -->
    <label for="cameraInput" class="file-input-label camera-btn">
      üì∑ Take Photo
    </label>
    <input type="file" id="cameraInput" class="hidden-input" accept="image/*" capture="environment" onchange="handleFileSelect(event)" />
    
    <!-- Gallery input -->
    <label for="galleryInput" class="file-input-label gallery-btn">
      üñºÔ∏è Choose from Gallery
    </label>
    <input type="file" id="galleryInput" class="hidden-input" accept="image/*" onchange="handleFileSelect(event)" />
  </div>

  <img id="preview" src="" alt="Image Preview" style="display:none;" />
  
  <div>
    <button id="detectBtn" onclick="uploadFile()" disabled>Identify Disease</button>
  </div>

  <div id="result"></div>

  <footer>
    <div class="avatar">EU</div>
    <p><strong>John Kikiiyin Aboderin</strong> ‚Ä¢ <em>EU200303-2312</em></p>
    <p>Elizade University</p>
  </footer>

  <script>
    let selectedFile = null;

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        selectedFile = file;
        showPreview(file);
        document.getElementById('detectBtn').disabled = false;
        
        // Clear result
        const resultEl = document.getElementById("result");
        resultEl.style.display = "none";
      }
      
      // Reset the input so same file can be selected again
      event.target.value = '';
    }

    function showPreview(file) {
      const preview = document.getElementById("preview");
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
    }

    async function uploadFile() {
      if (!selectedFile) {
        alert("Please select an image first.");
        return;
      }

      const formData = new FormData();
      formData.append("file", selectedFile);

      const resultEl = document.getElementById("result");
      const detectBtn = document.getElementById("detectBtn");
      
      // Show loading state
      resultEl.innerHTML = '<p class="loading">üî¨ Analyzing image...</p>';
      resultEl.style.display = "block";
      detectBtn.disabled = true;
      detectBtn.textContent = "Analyzing...";

      try {
        const response = await fetch(
          "https://tomatodisease-detection-backend.onrender.com/predict/",
          { method: "POST", body: formData }
        );
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.error) {
          resultEl.innerHTML = `<p class="error">‚ùå Error: ${result.error}</p>`;
        } else {
          resultEl.innerHTML = `
            <h3 style="color: #208fd0; margin-bottom: 15px;">üî¨ Diagnosis Results</h3>
            <div style="font-size: 18px;">
              <p><strong>Disease:</strong> <span class="success">${result.class}</span></p>
              <p><strong>Confidence:</strong> <span style="color: #208fd0;">${(result.confidence * 100).toFixed(2)}%</span></p>
            </div>
          `;
        }
      } catch (err) {
        resultEl.innerHTML = '<p class="error">‚ùå Error connecting to server. Please try again.</p>';
        console.error('Upload error:', err);
      } finally {
        detectBtn.disabled = false;
        detectBtn.textContent = "Identify Disease";
      }
    }
  </script>
</body>
</html>